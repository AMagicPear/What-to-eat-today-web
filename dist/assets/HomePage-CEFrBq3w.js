const __vite__fileDeps=["assets/EditFood-BHmCTnD2.js","assets/index-B9dFmjkY.js","assets/index-7CQuqmcz.css","assets/foodConstructor-Y02yJ501.js","assets/EditFood-i_kkb0uL.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{r as m,c as W,_ as P,t as $,d as b,w as E,o as k,a as R,b as A,n as H,e as d,f as v,g as _,u,I as M,h as C,i as V,j as O,k as J,l as j,m as q,p as z,q as N,s as U,v as G,x as K}from"./index-B9dFmjkY.js";import{s as S,F as D}from"./foodConstructor-Y02yJ501.js";const l=m([]),Q=()=>{const s=async a=>{const t={time:I.value,name:a};l.value.length>=50&&l.value.shift(),l.value.push(t),await S.set("log",JSON.parse(JSON.stringify(l.value))),console.log("成功保存记录")};return(async()=>{const a=await S.get("log");l.value=a?a.map(t=>({...t,time:new Date(t.time)})):[],console.log("已读取记录"),console.log(l.value)})(),{saveLog:s}},I=m(new Date),{foodList:F,saveFoods:X}=D(),{saveLog:Y}=Q(),w=W(async()=>{const{isCheckBoxDisabled:s,checkedList:r}=await P(()=>import("./EditFood-BHmCTnD2.js"),__vite__mapDeps([0,1,2,3,4]));let a=s.value?F.value:F.value.filter((t,n)=>r.value[n]);if(console.log("第一次筛选后的食物："),console.log(a),l.value.length>=2&&(console.log("最后两项：",l.value[l.value.length-1].name,l.value[l.value.length-2].name),a.length>2&&l.value[l.value.length-1].name===l.value[l.value.length-2].name&&(a=a.filter(t=>t.name!==l.value[l.value.length-1].name),console.log("第二次筛选后的食物："),console.log(a))),s.value&&l.value.length>=30){const n=l.value.slice(-30).map(g=>g.name),c=a.filter(g=>!n.includes(g.name));c.length>0&&(a=c),console.log("第三次筛选后的食物："),console.log(a)}return a.map(t=>{let n=0;return y.value==="早"?n=t.weight.morning:y.value==="早中"?n=(t.weight.morning+t.weight.noon)/2:y.value==="午"?n=t.weight.noon:n=t.weight.evening,{name:t.name,weight:n}})}),y=W(()=>{const s=I.value.getHours();return s>=6&&s<9?"早":s>=9&&s<11?"早中":s>=11&&s<14?"午":"晚"}),Z=async()=>{const s=await w.value;console.log("正在选择食物，当前可选食物列表："),console.log(s);const r=s.reduce((n,c)=>n+Number(c.weight),0);if(console.log("当前总重：".concat(r)),r===0)return await(await $.create({message:"当前时段所有可选食物的概率都为零，无法选择！",duration:2e3})).present(),null;const t=((n,c)=>{let g=Math.random()*c;for(const p of n)if(g-=Number(p.weight),g<=0)return p;return null})(s,r);if(t){const n=F.value.find(c=>c.name===t.name);n&&(console.log("选择了："),n.counts+=1,await X(),console.log(n),console.log("目前的食物列表："),console.log(F.value),await Y(n.name))}return t},ee={class:"wheel-container"},h=m(null),te=b({__name:"WheelSpinner",setup(s){const r=m(null),a=m(!1),t=m({}),n=m(0);let c=0;const g=async()=>{const e=document.createElement("canvas").getContext("2d");if(!e)return;e.canvas.width=300,e.canvas.height=300,e.translate(150,150);let o=0;const f=await w.value;f.forEach((i,L)=>{const x=i.weight/c*2*Math.PI;e.beginPath(),e.moveTo(0,0),e.arc(0,0,150,o,o+x),e.fillStyle="hsl(".concat(L/f.length*360,", 100%, 70%)"),e.fill(),e.save(),e.rotate(o+x/2),e.textAlign="right",e.fillStyle="#fff",e.font="16px Arial",e.fillText(i.name,130,10),e.restore(),o+=x}),r.value&&(r.value.style.backgroundImage="url(".concat(e.canvas.toDataURL(),")"))},p=e=>{if(a.value)return;a.value=!0;const o=2,f=e,i=n.value-n.value%360+f+1080;t.value={transform:"rotate(".concat(i,"deg)"),transition:"transform ".concat(o,"s ease-out")},setTimeout(()=>{a.value=!1,n.value=i;const L=i%360;console.log("Wheel stopped at ".concat(L," degrees")),alert(h.value.name)},o*1e3)},T=async()=>{let e=0;const o=new Map;return(await w.value).forEach(f=>{const i=f.weight/c*360;o.set(f.name,{start:e,end:e+i}),e+=i}),o},B=async()=>{if(a.value)return null;h.value=await Z();const e=await T();if(!h.value)return null;const o=e.get(h.value.name);return o?(p((o.start+o.end)/2),h):null};return E(w,async()=>{c=(await w.value).reduce((e,o)=>e+o.weight,0),g()},{immediate:!0}),(e,o)=>(k(),R("div",ee,[A("div",{class:"circle",ref_key:"wheel",ref:r,style:H(t.value)},null,4),d(u(M),{onClick:B},{default:v(()=>o[0]||(o[0]=[_("选择食物")])),_:1})]))}}),ne=C(te,[["__scopeId","data-v-65886576"]]);function ae(){I.value=new Date}const oe=b({__name:"HomePage",setup(s){const{loadFoods:r}=D();return V(()=>{setInterval(ae,6e4),r()}),(a,t)=>(k(),O(u(K),null,{default:v(()=>[d(u(q),null,{default:v(()=>[d(u(J),null,{default:v(()=>[d(u(j),null,{default:v(()=>t[0]||(t[0]=[_("今天吃什么")])),_:1})]),_:1})]),_:1}),d(u(G),{class:"ion-padding"},{default:v(()=>[d(u(z),null,{default:v(()=>[_(N(u(I)),1)]),_:1}),d(u(U),null,{default:v(()=>[_("今天的"+N(u(y))+"饭要吃的食物是：",1),t[1]||(t[1]=A("br",null,null,-1))]),_:1}),d(ne)]),_:1})]),_:1}))}}),re=C(oe,[["__scopeId","data-v-7f6fa8d0"]]);export{re as default};
