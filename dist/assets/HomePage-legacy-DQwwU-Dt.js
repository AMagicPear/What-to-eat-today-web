System.register(["./index-legacy-COTgx1O7.js","./foodConstructor-legacy-DVtJZmU0.js"],(function(e,a){"use strict";var t,l,n,o,u,s,i,r,c,v,g,d,f,m,h,w,p,y,x,_,b,k,C,I,S,D,E,L;return{setters:[e=>{t=e.r,l=e.c,n=e._,o=e.t,u=e.d,s=e.w,i=e.o,r=e.a,c=e.b,v=e.n,g=e.e,d=e.f,f=e.g,m=e.u,h=e.I,w=e.h,p=e.i,y=e.j,x=e.k,_=e.l,b=e.m,k=e.p,C=e.q,I=e.s,S=e.v,D=e.x},e=>{E=e.s,L=e.F}],execute:function(){var $=document.createElement("style");$.textContent=".wheel-container[data-v-65886576]{display:flex;flex-direction:column;align-items:center;margin-top:20px}.circle[data-v-65886576]{width:300px;height:300px;border:transparent;overflow:hidden}ion-button[data-v-65886576]{margin-top:20px;padding:10px 20px}ion-note[data-v-7f6fa8d0]{display:block}ion-button[data-v-7f6fa8d0]{margin:18px 0}\n",document.head.appendChild($);const j=t([]),F=t(new Date),{foodList:N,saveFoods:M}=L(),{saveLog:P}=((async()=>{const e=await E.get("log");j.value=e?e.map((e=>({...e,time:new Date(e.time)}))):[],console.log("已读取记录"),console.log(j.value)})(),{saveLog:async e=>{const a={time:F.value,name:e};j.value.length>=50&&j.value.shift(),j.value.push(a),await E.set("log",JSON.parse(JSON.stringify(j.value))),console.log("成功保存记录")}}),T=l((async()=>{const{isCheckBoxDisabled:e,checkedList:t}=await n((()=>a.import("./EditFood-legacy-DN1tldIZ.js")),void 0);let l=e.value?N.value:N.value.filter(((e,a)=>t.value[a]));if(console.log("第一次筛选后的食物："),console.log(l),j.value.length>=2&&(console.log("最后两项：",j.value[j.value.length-1].name,j.value[j.value.length-2].name),l.length>2&&j.value[j.value.length-1].name===j.value[j.value.length-2].name&&(l=l.filter((e=>e.name!==j.value[j.value.length-1].name)),console.log("第二次筛选后的食物："),console.log(l))),e.value&&j.value.length>=30){const e=j.value.slice(-30).map((e=>e.name)),a=l.filter((a=>!e.includes(a.name)));a.length>0&&(l=a),console.log("第三次筛选后的食物："),console.log(l)}return l.map((e=>{let a=0;return a="早"===A.value?e.weight.morning:"早中"===A.value?(e.weight.morning+e.weight.noon)/2:"午"===A.value?e.weight.noon:e.weight.evening,{name:e.name,weight:a}}))})),A=l((()=>{const e=F.value.getHours();return e>=6&&e<9?"早":e>=9&&e<11?"早中":e>=11&&e<14?"午":"晚"})),H={class:"wheel-container"},J=t(null),O=w(u({__name:"WheelSpinner",setup(e){const a=t(null),l=t(!1),n=t({}),u=t(0);let w=0;const p=async()=>{if(l.value)return null;J.value=await(async()=>{const e=await T.value;console.log("正在选择食物，当前可选食物列表："),console.log(e);const a=e.reduce(((e,a)=>e+Number(a.weight)),0);if(console.log(`当前总重：${a}`),0===a)return await(await o.create({message:"当前时段所有可选食物的概率都为零，无法选择！",duration:2e3})).present(),null;const t=((e,a)=>{let t=Math.random()*a;for(const l of e)if(t-=Number(l.weight),t<=0)return l;return null})(e,a);if(t){const e=N.value.find((e=>e.name===t.name));e&&(console.log("选择了："),e.counts+=1,await M(),console.log(e),console.log("目前的食物列表："),console.log(N.value),await P(e.name))}return t})();const e=await(async()=>{let e=0;const a=new Map;return(await T.value).forEach((t=>{const l=t.weight/w*360;a.set(t.name,{start:e,end:e+l}),e+=l})),a})();if(!J.value)return null;const a=e.get(J.value.name);return a?((e=>{if(l.value)return;l.value=!0;const a=e,t=u.value-u.value%360+a+1080;n.value={transform:`rotate(${t}deg)`,transition:"transform 2s ease-out"},setTimeout((()=>{l.value=!1,u.value=t;const e=t%360;console.log(`Wheel stopped at ${e} degrees`),alert(J.value.name)}),2e3)})((a.start+a.end)/2),J):null};return s(T,(async()=>{w=(await T.value).reduce(((e,a)=>e+a.weight),0),(async()=>{const e=document.createElement("canvas").getContext("2d");if(!e)return;e.canvas.width=300,e.canvas.height=300,e.translate(150,150);let t=0;const l=await T.value;l.forEach(((a,n)=>{const o=a.weight/w*2*Math.PI;e.beginPath(),e.moveTo(0,0),e.arc(0,0,150,t,t+o),e.fillStyle=`hsl(${n/l.length*360}, 100%, 70%)`,e.fill(),e.save(),e.rotate(t+o/2),e.textAlign="right",e.fillStyle="#fff",e.font="16px Arial",e.fillText(a.name,130,10),e.restore(),t+=o})),a.value&&(a.value.style.backgroundImage=`url(${e.canvas.toDataURL()})`)})()}),{immediate:!0}),(e,t)=>(i(),r("div",H,[c("div",{class:"circle",ref_key:"wheel",ref:a,style:v(n.value)},null,4),g(m(h),{onClick:p},{default:d((()=>t[0]||(t[0]=[f("选择食物")]))),_:1})]))}}),[["__scopeId","data-v-65886576"]]);function W(){F.value=new Date}e("default",w(u({__name:"HomePage",setup(e){const{loadFoods:a}=L();return p((()=>{setInterval(W,6e4),a()})),(e,a)=>(i(),y(m(D),null,{default:d((()=>[g(m(b),null,{default:d((()=>[g(m(x),null,{default:d((()=>[g(m(_),null,{default:d((()=>a[0]||(a[0]=[f("今天吃什么")]))),_:1})])),_:1})])),_:1}),g(m(S),{class:"ion-padding"},{default:d((()=>[g(m(k),null,{default:d((()=>[f(C(m(F)),1)])),_:1}),g(m(I),null,{default:d((()=>[f("今天的"+C(m(A))+"饭要吃的食物是：",1),a[1]||(a[1]=c("br",null,null,-1))])),_:1}),g(O)])),_:1})])),_:1}))}}),[["__scopeId","data-v-7f6fa8d0"]]))}}}));
