import{r as m,c as _,t as L,d as h,o as y,a as N,w as a,u as s,b,e as l,I as x,f as B,g as u,h as C,i as k,j as g,k as D,l as w,m as F,n as H,p as P,_ as T}from"./index-CEE-q8wp.js";import{s as I,F as V}from"./foodConstructor-HnYgMN58.js";const W=()=>{const e=m([]),n=async o=>{const t={time:d.value,name:o};e.value.push(t),await I.set("log",JSON.parse(JSON.stringify(e.value))),console.log("成功保存记录")};return(async()=>{const o=await I.get("log");e.value=o?o.map(t=>({...t,time:new Date(t.time)})):[],console.log("已读取记录"),console.log(e.value)})(),{saveLog:n}},d=m(new Date),{foodList:c,loadFoods:S,saveFoods:J}=V(),{saveLog:M}=W(),O=async()=>(await S(),c.value.map(e=>{let n=0;return i.value==="早"?n=e.weight.morning:i.value==="早中"?n=(e.weight.morning+e.weight.noon)/2:i.value==="午"?n=e.weight.noon:n=e.weight.evening,{name:e.name,weight:n}})),i=_(()=>{const e=d.value.getHours();return e>=6&&e<9?"早":e>=9&&e<11?"早中":e>=11&&e<14?"午":"晚"}),$=async()=>{const e=await O();console.log("正在选择食物，当前可选食物列表："),console.log(e);const n=e.reduce((t,r)=>t+Number(r.weight),0);if(console.log("当前总重：".concat(n)),n===0)return(await L.create({message:"当前时段所有可选食物的概率都为零，无法选择！",duration:2e3})).present(),null;const o=((t,r)=>{let v=Math.random()*r;for(const p of t)if(v-=Number(p.weight),v<=0)return p;return null})(e,n);if(o){const t=c.value.find(r=>r.name===o.name);t&&(console.log("选择了："),t.counts+=1,J(),console.log(t),console.log("目前的食物列表："),console.log(c.value),M(t.name))}return o};function j(){d.value=new Date}const q=h({__name:"HomePage",setup(e){y(()=>{setInterval(j,6e4)});const n=m();return(f,o)=>(b(),N(s(P),null,{default:a(()=>[l(s(C),null,{default:a(()=>[l(s(x),null,{default:a(()=>[l(s(B),null,{default:a(()=>o[1]||(o[1]=[u("今天吃什么")])),_:1})]),_:1})]),_:1}),l(s(H),{class:"ion-padding"},{default:a(()=>[l(s(k),null,{default:a(()=>[u(g(s(d)),1)]),_:1}),l(s(D),{onClick:o[0]||(o[0]=t=>s($)().then(r=>n.value=r))},{default:a(()=>o[2]||(o[2]=[u("选择食物")])),_:1}),o[4]||(o[4]=w("br",null,null,-1)),l(s(F),null,{default:a(()=>[u("今天的"+g(s(i))+"饭要吃的食物是：",1),o[3]||(o[3]=w("br",null,null,-1))]),_:1}),l(s(F),{style:{"text-align":"center"}},{default:a(()=>{var t;return[u(g((t=n.value)==null?void 0:t.name),1)]}),_:1})]),_:1})]),_:1}))}}),E=T(q,[["__scopeId","data-v-2e6c47cf"]]);export{E as default};
